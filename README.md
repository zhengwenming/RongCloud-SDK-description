# RongCloud-SDK-description-
ä¸‹é¢ä¸¤ç¯‡æ–‡ç« åˆ†åˆ«ä»‹ç»èäº‘çš„SDKå³æ—¶é€šè®¯æœºåˆ¶å’Œé›†æˆæ­¥éª¤ï¼Œç”±äºå›½å†…CSDNåšå®¢å°æ€æˆ‘è¿™æ ·çš„æ–‡ç« ï¼ˆè¯´æˆ‘æ‰“å¹¿å‘Šï¼‰ï¼Œæ‰€ä»¥åªèƒ½å»å›½å¤–å‘è¡¨äº†ã€‚å¸Œæœ›å¤§å®¶æ”¯æŒæˆ‘ï¼Œè°¢è°¢ã€‚
 
 è¯´è¯´èäº‘å³æ—¶é€šè®¯SDKç†è®ºç¯‡(ä¸€) 

æ ‡ç­¾ï¼š å³æ—¶é€šè®¯èŠå¤©èäº‘sdkiOS
2015-12-24 10:35 13äººé˜…è¯» è¯„è®º(0) æ”¶è— ç¼–è¾‘ å–æ¶ˆç½®é¡¶  åˆ é™¤
 åˆ†ç±»ï¼š
å³æ—¶é€šè®¯
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œæœªç»åšä¸»å…è®¸ä¸å¾—è½¬è½½ã€‚

æœ¬äººç”¨è¿‡èäº‘çš„1.4.4å’Œ2.2.4ç‰ˆæœ¬çš„SDKï¼Œåˆ†åˆ«ç”¨äºå¯¹ä¸¤æ¬¾APPçš„å³æ—¶é€šè®¯åŠŸèƒ½å¼€å‘é›†æˆï¼Œä¸»è¦ç”¨äº†IMKitç±»ï¼ŒåŠŸèƒ½ä¸ºå•èŠï¼ˆèŠå¤©å®¤å’Œç¾¤èŠä¸æ¶‰åŠï¼Œç†è§£äº†å•èŠï¼ŒèŠå¤©å®¤å’Œç¾¤èŠä¹Ÿå°±ä¸æ”»è€Œç ´ï¼‰,åæ§½ä¸€ä¸‹å…³äºiOSç«¯èäº‘SDKé›†æˆèµ„æ–™å¾ˆå°‘ï¼Œåªèƒ½çœ‹èäº‘å®˜æ–¹çš„å¼€å‘æ–‡æ¡£ï¼Œç„¶å¹¶åµï¼Œå®˜æ–¹æ–‡æ¡£ä¸åŠæ—¶æ›´æ–°ï¼Œè¯­è¨€å’Œå…³é”®è¯ç”¨çš„ä¹Ÿæ¯”è¾ƒå®˜æ–¹ä¸“ä¸šåŒ–ï¼Œæˆ‘æƒ³é€šä¿—æ˜“é€šï¼Œé›…ä¿—å…±èµçš„èµ„æ–™ï¼Œæ²¡ç”¨ï¼æ²¡ç”¨ï¼çœŸçš„æ²¡æœ‰ï¼åšå®¢ä¹‹ç±»çš„èµ„æ–™åªèƒ½æ‰¾åˆ°å®‰å“çš„æ–‡ç« ï¼Œæ— å¥ˆåªèƒ½çœ‹iOSå°å±Œä¸çœ‹å®‰å“å¤§ç¥å†™çš„å…³äºèäº‘é›†æˆçš„androidä»£ç ï¼Œå°ä¼™ä¼´ä»¬çœ‹çš„æ˜¯å¾ˆè›‹ç–¼ã€‚ç°åœ¨ç¦åˆ©æ¥äº†ï¼ŒiOSç«¯çš„èäº‘é›†æˆåšå®¢è¿™è¾¹çœ‹ï¼Œä¼šä¸æ–­æ›´æ–°ï¼ŒæŒç»­å…³æ³¨ã€‚æƒ³é›†æˆèäº‘èŠå¤©åŠŸèƒ½çš„å°ä¼™ä¼´ä¸é˜²å…ˆæ™®åŠä¸‹ç†è®ºçŸ¥è¯†ï¼Œé˜²æ­¢ä»¥åèµ°å¼¯è·¯åˆæˆ–è€…æ€»æ˜¯é—®äº›ä¸é è°±çš„é—®é¢˜ï¼Œâ€œæˆ‘ä¸ºä»€ä¹ˆä¸èƒ½èŠå¤©â€ï¼Œâ€œä¸ºä»€ä¹ˆå¤´åƒå’Œåå­—å‡ºä¸æ¥â€ç­‰ç­‰ä¸€ç³»åˆ—é—®é¢˜ï¼Œæ–‡ç« ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹å¸Œæœ›å¤§å®¶æå‡ºï¼Œæœ¬äººä¼šåŠæ—¶æ”¹æ­£ï¼Œé¿å…è¯¯äººå­å¼Ÿï¼Œé«˜æ‰‹å‹¿å–·ï¼Œå“ˆå“ˆã€‚ã€‚ã€‚

        èäº‘çš„SDKå¯ä»¥è§£å†³å¾ˆå¤šappä¸­å³æ—¶é€šè®¯çš„åŠŸèƒ½ï¼Œæ— è®ºæ˜¯å®‰å“è¿˜æ˜¯iOSï¼Œéƒ½å¯ä»¥è€ƒè™‘ç”¨ç¬¬ä¸‰æ–¹å»å®ç°èŠå¤©çš„åŠŸèƒ½ï¼Œè€Œä¸”ç°åœ¨appä¸­é›†æˆèŠå¤©çš„åŠŸèƒ½å¾ˆç«å¾ˆæ—¶é«¦ï¼Œä¸æ˜¯å—ï¼Ÿæ”¶åºŸå“ã€æ—§å®¶ç”µçš„è€æ¿éƒ½æ¨ä¸å¾—ä¸ºè‡ªå·±çš„APPåŠ ä¸Šå³æ—¶é€šè®¯ç¿…è†€ï¼Œè®©è‡ªå·±çš„appé£èµ·æ¥ã€‚åºŸè¯å°‘è¯´ï¼Œå…ˆæ¥ç†è§£ä¸‹èäº‘çš„å³æ—¶é€šè®¯æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯ç†è®ºéƒ¨åˆ†ã€‚

        èäº‘ä¸ç»´æŠ¤å¥½å‹å…³ç³»ï¼Œåªè´Ÿè´£è½¬å‘æ¶ˆæ¯ã€‚ä¸ç»´æŠ¤å¥½å‹å…³ç³»æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæˆ‘ç”¨èäº‘çš„SDKé›†æˆèŠå¤©ï¼Œå¥½å‹ä¹‹é—´éƒ½å¯ä»¥è¿›è¡ŒèŠå¤©å•Šï¼Œæ€ä¹ˆä¼šä¸ç»´æŠ¤å¥½å‹å…³ç³»å‘¢ï¼ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬æ¥ç†è§£ä¸‹ï¼šâ€œä¸ç»´æŠ¤å¥½å‹å…³ç³»ï¼Œåªè´Ÿè´£è½¬å‘æ¶ˆæ¯â€çš„æ„æ€æ˜¯èäº‘çš„æœåŠ¡å™¨ç»™æˆ‘ä»¬è½¬å‘æ¶ˆæ¯ï¼Œèäº‘çš„SDKå®Œæˆå‘é€æ¶ˆæ¯çš„åŠŸèƒ½ï¼ˆSDKä¸­çš„æ–¹æ³•å®ç°ï¼Œåå°ä¹Ÿå¯ä»¥è°ƒç”¨èäº‘æä¾›çš„æ¥å£å‘é€æ¶ˆæ¯ï¼‰ï¼Œæ¶ˆæ¯ä»ä¸€ä¸ªäººfromUserIdï¼ˆæ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªidï¼Œåé¢ä¼šè¯¦ç»†è®²åˆ°ï¼‰è½¬å‘åˆ°å¦ä¸€ä¸ªäººtoUserIdé‚£é‡Œï¼Œé‚£ä¹ˆæ¯ä¸ªç”¨æˆ·çš„å¥½å‹å…³ç³»å’Œç¾¤ç»„å…³ç³»æ˜¯è¦ä¿å­˜åœ¨è‡ªå·±å…¬å¸çš„æœåŠ¡å™¨çš„ï¼Œè¿™ç‚¹å°±è§£é‡Šäº†ä¸Šé¢çš„è¯ï¼Œèäº‘æä¾›ä¸€ä¸ªè½¬å‘æ¶ˆæ¯çš„å¹³å°ï¼ˆæœåŠ¡å™¨å’ŒSDKä»¥åŠæ¥å£ç­‰ï¼‰ï¼Œå› ä¸ºè¦æ»¡è¶³å¹¿å¤§å¼€å‘è€…çš„éœ€æ±‚ï¼Œæ‰€ä»¥ä¸å¯èƒ½ä¸ºæ²¡ä¸ªå¼€å‘è€…éƒ½ç»´æŠ¤è¿™ä¸ªå¥½å‹å…³ç³»å’Œç¾¤ç»„å…³ç³»ã€‚ä¸¾ä¸ªæ —å­ï¼Œç”¨æˆ·Aæœ‰100ä¸ªå¥½å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªèäº‘æ˜¯ä¸çŸ¥é“çš„ï¼Œä¹Ÿä¸ä¼šå…³å¿ƒç”¨æˆ·Açš„å¥½å‹å…³ç³»ï¼Œè°çŸ¥é“å‘¢ï¼Ÿæˆ‘ä»¬å¼€å‘è€…è‡ªå·±çš„åå°è¦çŸ¥é“ï¼Œæˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨è¦ç»´æŠ¤å¥½å‹å…³ç³»å’Œç¾¤ç»„å…³ç³»ï¼Œå…·ä½“åšæ³•å°±æ˜¯è¦ç”¨æ¥å£å»å»ºç«‹å¥½å‹å…³ç³»ï¼Œç„¶åå†ç”¨å¦å¤–çš„ä¸€ä¸ªæ¥å£å»ä¿å­˜ç”¨æˆ·Açš„æ‰€æœ‰å¥½å‹ã€‚è¿™æ ·çš„è¯ï¼Œç”¨æˆ·Aç™»å½•ä¹‹åå°±å¯ä»¥è°ƒç”¨å¥½å‹åˆ—è¡¨çš„æ¥å£æ‹¿åˆ°è‡ªå·±çš„æ‰€æœ‰å¥½å‹ï¼Œç„¶åå°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å’Œè‡ªå·±çš„å¥½å‹å‘é€æ¶ˆæ¯äº†ï¼Œå‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¸æ˜¯èµ°è‡ªå·±å…¬å¸çš„æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼Œæ³¨æ„ï¼Œè¿™é‡Œå‘é€æ¶ˆæ¯æ˜¯èµ°èäº‘çš„æœåŠ¡å™¨ï¼Œæ€ä¹ˆä¼šèµ°èäº‘çš„æœåŠ¡å™¨å‘¢ï¼Ÿå¥‡æ€ªï¼Œèäº‘æ€ä¹ˆçŸ¥é“æˆ‘ç™»å½•äº†å‘¢ï¼Ÿåˆ«æ€¥ï¼Œä¸‹é¢ä¼šè®²åˆ°tokenï¼Œä»¥åŠconnectè¿æ¥èäº‘æœåŠ¡å™¨ã€‚æ¶ˆæ¯çš„æµå‘æ˜¯è¿™æ ·çš„ï¼Œä»è‡ªå·±è¿™é‡ŒfromUserIdï¼ˆè‡ªå·±çš„idï¼‰èµ°åˆ°èäº‘çš„æœåŠ¡å™¨ï¼Œç„¶åèäº‘æœåŠ¡å™¨è½¬å‘åˆ°å¥½å‹toUserIdé‚£é‡Œï¼Œå› ä¸ºæ¶ˆæ¯ä½“ä¸­å«æœ‰å¾ˆå¤šçš„å±æ€§ï¼Œæ¶ˆæ¯ä½“æœ¬èº«å¯ä»¥é™„å¸¦ä¿¡æ¯ï¼Œæ¯”å¦‚targetIdï¼ˆå°±æ˜¯toUserIdï¼Œè¿™é‡Œä¸¤è€…ä¸€æ ·ï¼‰ï¼Œextraé™„åŠ ä¿¡æ¯ï¼Œç”¨äºæä¾›ç»™å¼€å‘è€…æ‹“å±•åŠŸèƒ½ï¼Œä½ æƒ³è®©æ¶ˆæ¯å¸¦ä»€ä¹ˆä¿¡æ¯éƒ½å¯ä»¥å¸¦ï¼Œä½†æ˜¯å¤§å°æœ‰é™åˆ¶ï¼Œä¸€èˆ¬å¸¦å­—ç¬¦ä¸²æˆ–jsonæ•°æ®ï¼Œæˆ‘ç”¨è¿™ä¸ªå­—æ®µè§£å†³äº†å¥½å‹å¤´åƒçš„åŠæ—¶æ›´æ–°åŠŸèƒ½ï¼Œè¿™ä¸ªå­—æ®µçš„ç”¨æ³•æ”¾å¼€å‘ç¯‡ç« ä¸­ç»†ç»†è®²è§£ã€‚

ç°åœ¨è¯´è¯´userIdï¼Œç”¨æˆ·çš„â€œèº«ä»½è¯å·ç â€ã€‚æ¯ä¸ªAPPçš„æ³¨å†Œç”¨æˆ·éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªuserIdï¼Œå°±æ˜¯ç”¨æ¥åŒºåˆ†ç”¨æˆ·çš„ï¼Œå°±å¥½åƒæˆ‘ä»¬çš„èº«ä»½è¯å·ç ä¸€æ ·ï¼Œä¸ä¼šé‡å¤ï¼Œå…·æœ‰å”¯ä¸€æ€§ã€‚é‚£ä¹ˆå†è¯´è¯´è°å»åˆ†é…ç”¨æˆ·Açš„userIdå‘¢ï¼Ÿèäº‘ä¼šåˆ†é…å—ï¼Ÿç­”æ¡ˆæ˜¯NOã€‚è¿˜æ˜¯é‚£å¥è¯èäº‘åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œåˆ†é…userIdè¿™ä¸ªä»»åŠ¡è¿˜æ˜¯è¦æˆ‘ä»¬åå°è‡ªå·±æ¥æï¼Œå½“ç”¨æˆ·Aæ³¨å†Œçš„æ—¶å€™ï¼Œåå°åˆ†é…ç»™Aä¸€ä¸ªuserIdå¹¶ä¸”è¿”å›ç»™å‰ç«¯å¼€å‘äººå‘˜ä½¿ç”¨ï¼Œå‰ç«¯å¼€å‘äººå‘˜æ‹¿åˆ°Açš„userIdä¹‹åï¼Œå°±è¦ç”¨è¿™ä¸ªAç”¨æˆ·çš„å”¯ä¸€çš„userIdå»ç™»å½•èäº‘çš„æœåŠ¡å™¨ï¼Œå½“ç„¶ä¸æ˜¯ä»»ä½•äººæœ‰ä¸ªuserIdéƒ½å¯ä»¥éšä¾¿è¿æ¥èäº‘çš„æœåŠ¡å™¨çš„å“¦ï¼Œå¤§å®¶éƒ½çŸ¥é“ä»»ä½•ç¬¬ä¸‰æ–¹å…¬å¸éƒ½æ²¡æœ‰é‚£ä¹ˆéšä¾¿ï¼Œä¸å®‰å…¨ï¼Œä¼šè¢«æ”»å‡»ï¼Œæ˜¯è¦TokenéªŒè¯çš„ã€‚æœ‰è¿™ä¸ªTokenå°±è®©ä½ è¿æ¥ï¼Œæ²¡æœ‰tokençš„è¯ï¼Œæ»šè›‹ã€‚æ•´ä¸ªç™»å½•çš„æµç¨‹æ˜¯è¿™æ ·æ»´ï¼Œå¼€å‘è€…å»èäº‘å®˜ç½‘æ³¨å†Œä¸ªè´¦å·---->ç™»å½•èäº‘å®˜ç½‘---->åˆ›å»ºä¸€ä¸ªåº”ç”¨---->æ‹¿åˆ°èäº‘åˆ†é…ç»™åº”ç”¨çš„appkey---->appä¸­ä»£ç å…ˆæ³¨å†Œèäº‘çš„appKey---->è·å–tokenè·å–token---->æ‹¿tokenå»connectèäº‘æœåŠ¡å™¨ã€‚å¤§æ¦‚å°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯å¼€å‘è¿‡ç¨‹ä¸­è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

ï¼ˆä¸€ï¼‰appkeyåŒ…æ‹¬æ­£å¼ä¸Šçº¿çš„appkeyå’Œå¼€å‘ç¯å¢ƒçš„appkeyã€‚ç°åœ¨çš„æ–°SDKå–æ¶ˆç”¨appSecretï¼Œæˆ‘ä»¬ä»£ç ä¸­ç”¨çš„æ˜¯appkeyï¼Œä¸æ˜¯appSecretï¼Œæ‰€ä»¥æš‚æ—¶ä¸è¦ç®¡appSecretï¼Œä½†æ˜¯ä¸è¦éšä¾¿åˆ·æ–°è¿™ä¸ªç§˜é’¥ï¼Œåæœè‡ªè´Ÿã€‚

ï¼ˆäºŒï¼‰tokenæ€ä¹ˆè·å–ï¼Œå“ªé‡Œå»è·å–ï¼Ÿtokençš„è·å–æ˜¯è¦è‡ªå·±å…¬å¸çš„åå°æä¾›ä¸€ä¸ªè·å–èäº‘tokençš„ä¸“é—¨æ¥å£ï¼Œè‡ªå·±çš„åå°å¼€å‘äººå‘˜å»çœ‹æ–‡æ¡£åšæ¥å£ï¼Œåå°ç›¸å…³äº‹æƒ…è¿™é‡Œä¸åšè§£ç­”ï¼ˆä¸€å¥è¯ï¼šå»çœ‹èäº‘å¼€å‘æ–‡æ¡£ï¼‰ã€‚è·å–åˆ°tokenåï¼Œå°±å¯ä»¥æ‹¿ä¸€ä¸ªç”¨æˆ·Açš„userIdå»è¿æ¥èäº‘çš„æœåŠ¡å™¨äº†ï¼Œèäº‘çš„æ–¹æ³•å«connectWithTokenï¼ŒconnectæˆåŠŸäº†ä¹‹åä¼šè¿”å›ç™»å½•äººçš„userIdï¼Œå¤±è´¥äº†ä¼šè¿”å›errorçš„æè¿°ï¼ˆä¸€ä¸ªæšä¸¾ï¼Œè¯¦ç»†çš„è§£é‡Šconnectå¤±è´¥çš„åŸå› ï¼‰ã€‚å…·ä½“çœ‹ä¸‹é¢ä»£ç ï¼Œæ³¨æ„ï¼Œæˆ‘çš„åšæ³•æ˜¯æ¯æ¬¡éƒ½è·å–tokenï¼Œè¿˜æœ‰å…¶ä»–çš„å¤„ç†tokenæ–¹å¼ï¼Œå…·ä½“çš„çœ‹èäº‘å¼€å‘æŒ‡å—ï¼Œæˆ‘è¿™é‡Œæä¾›ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚

 [[RCIMsharedRCIM]connectWithToken:YourToken success:^(NSString *userId) {

                    [RCIMsharedRCIM].globalNavigationBarTintColor = [UIColorwhiteColor];

                    NSLog(@"login success with userId %@",userId);

                    [UserInfoModel loginUserinfo:model];

                    //åŒæ­¥å¥½å‹åˆ—è¡¨

                    [self syncFriendList:^(NSMutableArray *friends,BOOL isSuccess) {

                        NSLog(@"%@",friends);

                        if (isSuccess) {

                            NSLog(@" successå‘é€é€šçŸ¥");

                            [[NSNotificationCenterdefaultCenter]postNotificationName:@"alreadyLogin" object:nil];//å‘é€è‡ªå®šä¹‰é€šçŸ¥ï¼ˆä¸æ˜¯èäº‘çš„ï¼‰ï¼Œå¤„ç†ä¸€äº›é€»è¾‘ï¼Œæ¯”å¦‚ä»€ä¹ˆå„å•ä½æ³¨æ„ï¼Œæˆ‘å·²ç™»å½•ï¼Œæˆ‘å·²ç™»å½•ã€‚

                        }

                    }];

                    [RCIMClient sharedRCIMClient].currentUserInfo = [[RCUserInfoalloc]initWithUserId:userinfo.userIdname:userinfo.userNameportrait:userinfo.photophone:userinfo.phoneaddressInfo:userinfo.companyrealName:userinfo.realName];

                   

                } error:^(RCConnectErrorCode status) {

                    NSLog(@"status = %ld",(long)status);

                } tokenIncorrect:^{

                    self.success =NO;

                    [MSUtil showTipsWithHUD:@"tokenIncorrect"];

                }];


è¿æ¥æˆåŠŸäº†ï¼Œç»§ç»­çœ‹ã€‚è¦æƒ³å’Œå¥½å‹èŠå¤©ï¼Œæˆ‘ä»¬è¿˜è¦æœ‰å¥½å‹ï¼Œæœ‰äº†å¥½å‹æ‰èƒ½æ­£å¸¸èŠå¤©ï¼Œæˆ‘çš„å¥½å‹æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„æ•°ç»„é‡Œé¢çš„ï¼Œappå¯åŠ¨çš„æ—¶å€™ï¼Œæˆ‘ç½‘ç»œè¯·æ±‚è‡ªå·±çš„åå°ï¼Œæ‹¿åˆ°æˆ‘ä»¬åå°ç»´æŠ¤çš„å¥½å‹æ•°ç»„ï¼Œç„¶åæ”¾æ•°ç»„é‡Œé¢ï¼Œè¿™æ ·æˆ‘å…¨å±€å¯ä»¥æ‹¿åˆ°ã€‚å¦å¤–ï¼Œè¿˜è¦å®ç°ä¸€ä¸ªä»£ç†æ–¹æ³•ï¼Œè¿™ä¸ªä»£ç†å«åšRCIMUserInfoDataSourceï¼ˆ2.2.4ç‰ˆæœ¬çš„å«RCIMUserInfoDataSourceï¼Œä»¥å‰çš„è€ç‰ˆæœ¬æ¯”è¾ƒéº»çƒ¦äº›ï¼Œè¦å®ç°ä¸¤ä¸ªä»£ç†

RCIMFriendsFetcherDelegate,RCIMUserInfoFetcherDelegagte

ï¼‰è¿™ä¸ªä»£ç†æ–¹æ³•æ˜¯æä¾›å¥½å‹ä¿¡æ¯çš„ï¼Œç»™è°æä¾›å¥½å‹ä¿¡æ¯ï¼Ÿä½ å’Œä½ çš„å¥½å‹èŠå¤©ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨èµ°ä»£ç†æ–¹æ³•ï¼Œå»æ‹¿å¥½å‹ä¿¡æ¯ï¼Œæ‰€ä»¥é‚£äº›è¯´â€œæˆ‘çš„å¥½å‹å¤´åƒå’Œåå­—æ€ä¹ˆå‡ºä¸æ¥â€çš„åŒå­¦è¦æ³¨æ„äº†ï¼Œéµå®ˆä»£ç†äº†å—ï¼Ÿæ˜¯ä¸æ˜¯ä½ çš„ä»£ç†æ²¡è®¾ç½®ï¼Œæ˜¯ä¸æ˜¯æ²¡å®ç°ä»£ç†æ–¹æ³•ï¼Œæ–¹æ³•é‡Œé¢æœ‰æ²¡æœ‰é—®é¢˜ï¼Œæœ‰æ²¡æœ‰é…ç½®å¥½ä½ çš„å¥½å‹ä¿¡æ¯ï¼Ÿä¸ç„¶å¥½å‹å¤´åƒå’Œåå­—æ€ä¹ˆä¼šå‡ºä¸æ¥å‘¢ï¼é™„ä¸Šä»£ç†æ–¹æ³•åå­—å’Œå®ç°
- (void)getUserInfoWithUserId:(NSString*)userId completion:(void (^)(RCUserInfo*))completion

{

    NSLog(@"getUserInfoWithUserId ----- %@", userId);

    

    if (userId == nil || [userId length] == 0 )

    {

        completion(nil);

        return ;

    }

   

    if ([userIdisEqualToString:[RCIMsharedRCIM].currentUserInfo.userId]) {//è‡ªå·±

        UserInfoModel *myselfInfo = [UserInfoModelcurrentUserinfo];

        RCUserInfo *aUser = [[RCUserInfoalloc]initWithUserId:myselfInfo.userIdname:myselfInfo.realNameportrait:myselfInfo.photophone:myselfInfo.phoneaddressInfo:myselfInfo.companyrealName:myselfInfo.realName];

        completion(aUser);

    }

    

    for (NSInteger i =0; i<[AppDelegateshareAppDelegate].friendsArray.count; i++) {//å¾ªç¯å…¨å±€çš„å¥½å‹æ•°ç»„ï¼Œæ‹¿åˆ°userIdç›¸åŒçš„ï¼Œæ¯”å¦‚ï¼ŒuserIdï¼ 12çš„æ˜¯è€ç‹ï¼Œé‚£ä¹ˆå¾ªç¯ï¼Œæ‰¾åˆ°æ•°ç»„ä¸­userIdï¼12çš„ï¼Œé‚£ä¹ˆè‚¯å®šå°±æ˜¯è€ç‹å•¦ã€‚é‚£ä¹ˆè‚¯å®šå°±é…ç½®å¥½è€ç‹çš„ä¿¡æ¯äº†ï¼Œå’Œè€ç‹èŠå¤©çš„æ—¶å€™ï¼Œèäº‘å†…éƒ¨å°è£…çš„æ–¹æ³•å°±å¯ä»¥æ‹¿åˆ°è€ç‹çš„ä¿¡æ¯ï¼Œè¿™æ ·è€ç‹çš„å¤´åƒå’Œåå­—å°±å¯ä»¥å‡ºæ¥äº†

        RCUserInfo *aUser = [AppDelegateshareAppDelegate].friendsArray[i];

        if ([userId isEqualToString:aUser.userId]) {

            completion(aUser);

        }

    }

}




æœ€åå¼€å§‹å‘æ¶ˆæ¯ç»™å¥½å‹ï¼Œæ¯”å¦‚ç‚¹å‡»ä¸€ä¸ªcellï¼ˆæˆ–è€…ä¸€ä¸ªé¡µé¢çš„Buttonï¼‰ï¼Œæ‹¿åˆ°è¿™ä¸ªcellå¯¹åº”äººçš„userIdï¼Œæ‹¿åˆ°å¯¹æ–¹çš„userIdåï¼Œå°±å¯ä»¥å»ºç«‹ä¸€ä¸ªä¼šè¯äº†ï¼Œé‚£ä¹ˆå¼€å§‹ä¸Šä»£ç 

ConversationViewController *_conversationVC = [[ConversationViewControlleralloc]init];

_conversationVC.conversationType = ConversationType_PRIVATE;//å•èŠï¼ˆä¹Ÿå«ç§èŠï¼‰ï¼Œä¼šè¯ç±»å‹

_conversationVC.targetId = [NSStringstringWithFormat:@"%@",model.data[@"id"]];//æ¶ˆæ¯çš„ç›®æ ‡idï¼Œå¯¹æ–¹çš„userIdï¼Œå°±æ˜¯ä¸Šæ–‡è¯´çš„toUserId

_conversationVC.userName = [NSStringstringWithFormat:@"%@",model.data[@"agentTeamName"]];//ä¼šè¯å¯¹æ–¹çš„äººåå­—

_conversationVC.title = [NSStringstringWithFormat:@"%@",model.data[@"realName"]];//ä¼šè¯å¯¼èˆªä¸Šçš„title

[self.navigationControllerpushViewController:_conversationVCanimated:YES];



ConversationViewControlleræ˜¯å¼€å‘è€…è‡ªå·±å»ºç«‹çš„VCï¼Œç»§æ‰¿èäº‘çš„RCConversationViewControllerç±»ï¼Œç»§æ‰¿ä¹‹åï¼Œå­ç±»å°±å¯ä»¥ç”¨é‡å†™çˆ¶ç±»çš„æ–¹æ³•äº†ï¼Œæƒ³ç”¨ä»€ä¹ˆå°±ç‚¹è¿›å»æ‰¾ä»€ä¹ˆæ–¹æ³•

å¥½äº†ï¼Œç°åœ¨å¯ä»¥å‘é€æ¶ˆæ¯äº†ï¼Œå› ä¸ºRCConversationViewControllerç±»å·²ç»å®ç°äº†UIå’ŒåŠŸèƒ½ã€‚



ç†è®ºç¯‡åˆ°æ­¤ç»“æŸã€‚ä¸‹é¢ä¼šæœ‰å¼€å‘ç¯‡ï¼Œè°¢è°¢ã€‚æœ‰é—®é¢˜åœ¨æˆ‘çš„å¼€å‘ç¾¤é‡Œæé—®ï¼Œç¾¤å·487599875.






 è¯´è¯´èäº‘å³æ—¶é€šè®¯SDKå¼€å‘ç¯‡(äºŒ) 



ç†è®ºçŸ¥è¯†ç†è§£ä¹‹åï¼Œå°±å¯ä»¥å¿«é€Ÿé›†æˆäº†ã€‚æœ‰å¤šå¿«ï¼Ÿå¸¸å¸¸æœ‰å¼€å‘è€…é—®ï¼Œä¸€å¤©å¯ä»¥é›†æˆèäº‘çš„èŠå¤©åŠŸèƒ½å—ï¼Ÿæˆ‘æƒ³è¯´æˆ‘ç°åœ¨ä¸€å¤©éƒ½æä¸å®šï¼Œä½ ä¸ç”¨å¤„ç†é€»è¾‘çš„å—ï¼Ÿä½ ä»…ä»…æ˜¯å†™ä¸ªdemoè¿˜æ˜¯åšé¡¹ç›®å•Šï¼Ÿå¦‚æœæ˜¯å†™ä¸ªdemoï¼Œæˆ‘1ä¸ªå°æ—¶å¯ä»¥é›†æˆèŠå¤©åŠŸèƒ½äº†ã€‚æ‰€ä»¥å¤§å®¶è¿˜æ˜¯è¦æŒ‰éƒ¨å°±ç­çš„æ¥ï¼Œæ¬²é€Ÿæµ‹ä¸è¾¾ã€‚

å¥½äº†ï¼Œä¸æ‰¯æ·¡äº†ï¼Œå¼€å§‹é›†æˆã€‚

ä¸€ï¼Œå»èäº‘å®˜ç½‘ï¼ˆhttp://www.rongcloud.cnï¼‰ä¸‹è½½SDKã€‚è¡¥å……ä¸€å¥æœ€å¥½ç”¨å®˜ç½‘æœ€æ–°çš„SDKï¼Œåƒä¸‡ä¸è¦å€’é€€å•Šï¼Œæœ€æ–°çš„SDKæ¯”è¾ƒå®Œå–„ï¼ŒæŠŠä»¥å‰æ—§ç‰ˆæœ¬çš„SDKçš„bugéƒ½ä¿®å¤äº†ï¼Œå½“ç„¶è‚¯å®šè¿˜æœ‰bugå­˜åœ¨ï¼Œä½†æ˜¯å·²ç»æ¯”è¾ƒå°‘äº†ï¼Œè€Œä¸”ä½ ä¹Ÿä¸ä¸€å®šå°±è¸©åˆ°é›·äº†ï¼Œå¦‚æœè¸©åˆ°äº†ï¼Œå»ç»™èäº‘å‘å·¥å•ï¼Œæ¯ä¸ªå·¥å•éƒ½ä¼šå¾—åˆ°å›ç­”ï¼Œå¤§éƒ¨åˆ†ä¼šä»¤ä½ æ»¡æ„çš„ï¼Œä¸æ»¡æ„ä¹Ÿæ²¡åŠæ³•ã€‚å¥½äº†ï¼Œä¸‹è½½å®Œä¹‹åæ‰¾åˆ°SDKçš„æ–‡ä»¶å¤¹ï¼Œæ‰“å¼€ï¼Œç„¶åè‡ªå·±åœ¨è‡ªå·±å·¥ç¨‹ä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹æ¯”å¦‚æˆ‘çš„å°±æ˜¯RongCloud_SDK_2_2_4ï¼Œè¿™æ ·æ¸…æ™°æ˜äº†çš„çœ‹åˆ°äº†ä½œç”¨å’Œç‰ˆæœ¬å·ï¼Œå†ç„¶åå°±æ˜¯æ‹–SDKè¿›æ¥å·¥ç¨‹ä¸­çš„æ–‡ä»¶å¤¹RongCloud_SDK_2_2_4ï¼Œé™¤å»release_notes_ios.txtä¸ç”¨æ‹–è¿›æ¥ï¼Œå…¶ä»–çš„éƒ½æ‹–è¿›æ¥ï¼Œä¸ç„¶ä½ å°±æ‹–äº†ä¸¤ä¸ªframeWorkï¼Œåé¢å¼€å‘ä¸­è‚¯å®šä½ ä¼šå«ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„è¡¨æƒ…ğŸ˜Šå‡ºä¸æ¥ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„æ˜¯è‹±æ–‡çš„ï¼Œå„ç§å¥‡è‘©bugå‡ºç°äº†ï¼Œæ„¿æ„å°±åœ¨æ­¤ï¼Œä½ è¦æŠŠemojiçš„plistæ–‡ä»¶å’Œè¯­è¨€å›½é™…åŒ–çš„ä¸œä¸œä¹Ÿä¸€èµ·æ‹‰è¿›å·¥ç¨‹ã€‚è®°å¾—ç‚¹å‡»copyé€‰é¡¹ã€‚

äºŒï¼Œæ·»åŠ frameWorkï¼Œè€Œä¸”è¦å…¨é¢ã€‚åœ¨ç¬¬ä¸€æ­¥çš„åŸºç¡€ä¸Šæ·»åŠ èäº‘SDKçš„ä¾èµ–åº“ï¼Œéƒ½æ˜¯ç³»ç»Ÿçš„ï¼Œå®˜ç½‘æœ‰åº“åˆ—è¡¨ï¼Œæ…¢æ…¢åŠ ã€‚

AssetsLibrary.framework
AudioToolbox.framework
AVFoundation.framework
CFNetwork.framework
CoreAudio.framework
CoreGraphics.framework
CoreLocation.framework
CoreMedia.framework
CoreTelephony.framework
CoreVideo.framework
ImageIO.framework
libc++.tbd
libc++abi.tbd
libsqlite3.tbd
libstdc++.tbd
libxml2.tbd
libz.tbd
MapKit.framework
OpenGLES.framework
QuartzCore.framework
SystemConfiguration.framework
UIKit.framework

ä¸‰ã€å¯¼å…¥å¤´æ–‡ä»¶
#import <RongIMKit/RongIMKit.h>

è¿™ä¸ªä¸€èˆ¬åº”è¯¥æ˜¯åœ¨appdelegateé‡Œé¢å€’å…¥ï¼Œå› ä¸ºç¨‹åºå…¥å£ï¼Œæˆ‘ä»¬è¦åˆå§‹åŒ–èäº‘çš„appkeyï¼ˆç†è®ºç¯‡æœ‰è¯¦ç»†ä»‹ç»ï¼Œå¼€å‘ç¯‡ä¸å†èµ˜è¿°ï¼‰ã€‚
åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åˆå§‹åŒ–
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions ï¼Œæœ€å¥½å†™ä¸€ä¸ªæ–¹æ³•ä¸“é—¨æ”¾ç½®èäº‘çš„é€»è¾‘ï¼ŒinitRongCloudæ–¹æ³•æ”¾ç½®èäº‘çš„åˆå§‹åŒ–

- (void)initRongCloud{

    self.friendsArray = [[NSMutableArray alloc]init];

    //æµ‹è¯•ç¯å¢ƒ          AppKey XXXXXAppKey        AppSecret XXXXXXAppSecret

    //æ­£å¼ä¸Šçº¿ç¯å¢ƒ       AppKey XXXXXAppKey       AppSecret  XXXXXAppKey

    NSString *rongYunKey = @"yourAPPKey";

    if ([kNetwork_Host isEqualToString:@"http://weixintest.ihk.cn"]) {//æ­£å¼ç¯å¢ƒç”¨æ­£å¼keyï¼Œå¼€å‘æµ‹è¯•ç¯å¢ƒç”¨æµ‹è¯•çš„key

        rongYunKey = @"yourAPPKey";

    }

    [[RCIM sharedRCIM] initWithAppKey:rongYunKey];

    [RCIM sharedRCIM].userInfoDataSource = [RCDataManager shareManager];

/**enableMessageAttachUserInfo

 *  é»˜è®¤NOï¼Œå¦‚æœYESï¼Œå‘é€æ¶ˆæ¯ä¼šåŒ…å«è‡ªå·±ç”¨æˆ·ä¿¡æ¯ã€‚

 */


    [RCIM sharedRCIM].enableMessageAttachUserInfo = YES;



    [[RCDataManager shareManager] loginRongCloud];

}

åˆå§‹åŒ–å®Œæˆåå°±æ˜¯æ‹¿tokenï¼Œç„¶åç”¨ä¸€ä¸ªäººçš„userIdå»connectäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªé€»è¾‘æˆ‘æ²¡æœ‰æŠŠä»£ç å†™åœ¨appdelegateï¼Œå› ä¸ºä¸šåŠ¡ç›¸åŒçš„é€»è¾‘åº”è¯¥åˆ†ç¦»å‡ºæ¥ï¼Œè¦ä¸å…¨éƒ¨ä»£ç å†™appdelegateé‡Œé¢å¤ªä¹±ï¼Œå¤ªéš¾ç»´æŠ¤ï¼Œæˆ‘ä»¬æŠŠæœ‰å…³èäº‘çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œæ”¾ä¸€ä¸ªç±»RCDataManagerä¸­å»ç®¡ç†ï¼Œé‚£ä¹ˆæˆ‘çš„è¿™ä¸ªRCDataManagerå®Œæˆäº†ä»€ä¹ˆåŠŸèƒ½ï¼Œä»€ä¹ˆé€»è¾‘ï¼Œå…·ä½“æ€ä¹ˆè®¾è®¡è¿™ä¸ªç±»ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸‹æ€ä¹ˆæŠŠèäº‘çš„é€»è¾‘æ¨¡å—åˆ†ç¦»å‡ºæ¥ï¼Œå†™å‡ºé«˜ä¸€ç‚¹è´¨é‡çš„ä»£ç ã€‚
RCDataManageræ˜¯ä¸ªå•ä¾‹ç±»ï¼Œä¸»è¦åŠŸèƒ½å°±æ˜¯ç™»å½•èäº‘ï¼Œåˆ·æ–°å¥½å‹åˆ—è¡¨ï¼Œè®¾ç½®å¥½å‹ä¿¡æ¯æä¾›è€…ä»£ç†ç­‰ç­‰ï¼Œè®¾ç½®tabbarçš„è§’æ ‡ç­‰ç­‰ã€‚ä»–çš„å¥½å¤„æ˜¯æŠŠèäº‘çš„é€»è¾‘åˆ†ç¦»å‡ºæ¥ï¼Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œæ–¹ä¾¿ç»´æŠ¤å·¥ç¨‹ï¼Œæˆ‘ä»¬ç”¨çš„æ—¶å€™å°±ä¸€å¥ä»£ç å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚ç™»å½•å°±è¿™æ · [[RCDataManager shareManager] loginRongCloud];å…·ä½“RCDataManagerç±»çš„ä»£ç å¦‚ä¸‹ï¼š

@interface RCDataManager : NSObject<RCIMUserInfoDataSource>







@property(nonatomic,assign)BOOL success;

+(RCDataManager *) shareManager;

- (void)getUserInfoWithUserId:(NSString*)userId completion:(void (^)(RCUserInfo*))completion;

/**

 *  ä»æœåŠ¡å™¨åŒæ­¥å¥½å‹åˆ—è¡¨

 */

-(BOOL)hasTheFriendWithUserId:(NSString *)userId;

-(void)loginRongCloud;

-(void) syncFriendList:(void (^)(NSMutableArray * friends,BOOL isSuccess))completion;

-(void)refreshBadgeValue;

-(NSString *)currentNameWithUserId:(NSString *)userId;

-(RCUserInfo *)currentUserInfoWithUserId:(NSString *)userId;

@end

ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼åä¸½ä¸½çš„åˆ†å‰²çº¿ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
å†çœ‹å®ç°æ–‡ä»¶é‡Œé¢çš„ä»£ç 

#import "RCDataManager.h"



@implementation RCDataManager{

    NSMutableArray *dataSoure;



}

- (instancetype)init{

    if (self = [super init]) {

        [RCIM sharedRCIM].userInfoDataSource = self;

        dataSoure = [[NSMutableArray alloc]init];

    }

    return self;

}



+ (RCDataManager *)shareManager{

    static RCDataManager* manager = nil;

    static dispatch_once_t predicate;

    dispatch_once(&predicate, ^{

        manager = [[[self class] alloc] init];

    });

    return manager;

}



-(void)syncFriendList:(void (^)(NSMutableArray* friends,BOOL isSuccess))completion

{

    UsersType type = [MSUtil checkUserType];

    if (type==UsersTypeYouke) {//æ¸¸å®¢

    //ä¸èƒ½èŠå¤©

        NSLog(@"æ¸¸å®¢ å‘é€é€šçŸ¥");



        [[NSNotificationCenter defaultCenter] postNotificationName:@"alreadyLogin" object:nil];

    }

    else if(type==UsersTypeSales){//é”€å”®

        /* è·å–æˆ‘çš„å®¢æˆ·(åŒ…æ‹¬é”€å”®) */

        [Networking getMyClientsWithPage:@"1" pagesize:@"10000" success:^(NetworkModel *model) {

            NSLog(@"%@",model.msg);



            if ([model.data isKindOfClass:[NSString class]]) {

                //LOGIN_CHECK_NO

                NSLog(@"%@",model.data);

            }else if ([model.data isKindOfClass:[NSDictionary class]]){

                [dataSoure removeAllObjects];

            

                for (NSDictionary *infoDic in model.data[@"rows"]) {

                    RCUserInfo *userInfo = [[RCUserInfo alloc]init];

                    userInfo.userId = [NSString stringWithFormat:@"%@",infoDic[@"id"]];

//                    if ([[NSString stringWithFormat:@"%@",infoDic[@"salesNickName"]] isEqualToString:@""]) {

//                        userInfo.name = [NSString stringWithFormat:@"%@",infoDic[@"realName"]];

//                    }else{

//                        userInfo.name = [NSString stringWithFormat:@"%@  %@",infoDic[@"realName"],infoDic[@"salesNickName"]];

//                    }



                    userInfo.name = [[NSString stringWithFormat:@"%@",infoDic[@"realName"]] isEqualToString:@""]?[NSString stringWithFormat:@"%@",infoDic[@"loginName"]]:[NSStringstringWithFormat:@"%@",infoDic[@"realName"]];

                    userInfo.portraitUri = [NSString stringWithFormat:@"%@",infoDic[@"photo"]];

                    userInfo.phone = [NSString stringWithFormat:@"%@",infoDic[@"phone"]];

                    userInfo.addressInfo = [NSString stringWithFormat:@"%@",infoDic[@"company"]];

                    userInfo.realName = [NSString stringWithFormat:@"%@",infoDic[@"realName"]];



                    [dataSoure addObject:userInfo];

                    

                }

                [AppDelegate shareAppDelegate].friendsArray = dataSoure;

                completion(model.data[@"rows"],[model.result isEqualToString:@"10000"]?YES:NO);



                NSLog(@"å¥½å‹åˆ—è¡¨ = %@",[AppDelegate shareAppDelegate].friendsArray);

                if ([AppDelegate shareAppDelegate].friendsArray.count) {

                    NSLog(@"ä»æœåŠ¡å™¨åŒæ­¥å¥½å‹åˆ—è¡¨æˆåŠŸFFF");

                    [self loginRongCloud];

                    for (RCUserInfo *aUser in [AppDelegate shareAppDelegate].friendsArray) {

                        NSLog(@"name =%@ userId =%@",aUser.name ,aUser.userId);

                    }

                }

            }

            

        } fail:^(NSError *error) {

            NSLog(@"errorï¼ %@",error);

            NSLog(@"ä»æœåŠ¡å™¨åŒæ­¥å¥½å‹åˆ—è¡¨å¤±è´¥ ï½ï½ï½");



        }];

    }else if(type==UsersTypeCustomer){//ç”¨æˆ·

        [Networking getMyBrokerAppUsersWithPage:@"1" pagesize:@"10000" success:^(NetworkModel *model) {

            if ([model.data isKindOfClass:[NSString class]]) {

                

            }else if ([model.data isKindOfClass:[NSDictionary class]]){

                [dataSoure removeAllObjects];

    

                for (NSDictionary *infoDic in model.data[@"rows"]) {

                    

                    RCUserInfo *userInfo = [[RCUserInfo alloc]init];

                    userInfo.userId = [NSString stringWithFormat:@"%@",infoDic[@"id"]];

                    

                    userInfo.name = [[NSString stringWithFormat:@"%@",infoDic[@"salesNickName"]] isEqualToString:@""]?[NSString stringWithFormat:@"%@",infoDic[@"realName"]]:[NSStringstringWithFormat:@"%@",infoDic[@"salesNickName"]];

                    userInfo.portraitUri = [NSString stringWithFormat:@"%@",infoDic[@"photo"]];

                    userInfo.phone = [NSString stringWithFormat:@"%@",infoDic[@"phone"]];

                    userInfo.addressInfo = [NSString stringWithFormat:@"%@",infoDic[@"company"]];

                    userInfo.realName = [NSString stringWithFormat:@"%@",infoDic[@"realName"]];



                    [dataSoure addObject:userInfo];



                }

                [AppDelegate shareAppDelegate].friendsArray = dataSoure;

                NSLog(@"å¥½å‹åˆ—è¡¨ = %@",[AppDelegate shareAppDelegate].friendsArray);

                completion(model.data[@"rows"],[model.result isEqualToString:@"10000"]?YES:NO);



                if ([AppDelegate shareAppDelegate].friendsArray.count) {

                    NSLog(@"ä»æœåŠ¡å™¨åŒæ­¥å¥½å‹åˆ—è¡¨æˆåŠŸFFF");

                    if ([RCIMClient sharedRCIMClient].currentUserInfo.userId) {

                        

                    }else{

                        [self loginRongCloud];



                    }

                    for (RCUserInfo *aUser in [AppDelegate shareAppDelegate].friendsArray) {

                        NSLog(@"name = %@",aUser.name);

                        NSLog(@"name = %@",aUser.userId);

                    }

                }

            }

        } fail:^(NSError *error) {

            NSLog(@"error ï¼ %@",error);

            NSLog(@"ä»æœåŠ¡å™¨åŒæ­¥å¥½å‹åˆ—è¡¨å¤±è´¥ ï½ï½ï½");





        }];

    }

}

//è·å–ä¸€ä¸ªuserIdå¯¹åº”çš„å¥½å‹å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æˆ‘ä»¬å«åšRCUserInfoï¼Œè¿™ä¸ªæ˜¯èäº‘çš„ç±»ï¼Œæˆ‘ä»¬çœ‹çœ‹æºä»£ç çš„.hé‡Œé¢æ€ä¹ˆå†™

-(RCUserInfo *)currentUserInfoWithUserId:(NSString *)userId{

    for (NSInteger i = 0; i<[AppDelegate shareAppDelegate].friendsArray.count; i++) {

        RCUserInfo *aUser = [AppDelegate shareAppDelegate].friendsArray[i];

        if ([userId isEqualToString:aUser.userId]) {

            NSLog(@"current ï¼ %@",aUser.name);

            return aUser;

        }

    }

    return nil;

}

è¿™æ˜¯RCUserInfoçš„.h
/**

 *  ç”¨æˆ·ä¿¡æ¯ç±»

 */

@interface RCUserInfo : NSObject <NSCoding>

/** ç”¨æˆ·ID */

@property(nonatomic, strong) NSString *userId;

/** ç”¨æˆ·å*/

@property(nonatomic, strong) NSString *name;

/** å¤´åƒURL*/

@property(nonatomic, strong) NSString *portraitUri;



/**

 *  æŒ‡æ´¾çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæ ¹æ®ç»™å®šå­—æ®µåˆå§‹åŒ–å®ä¾‹

 *

 *  @param userId       ç”¨æˆ·ID

 *  @param username     ç”¨æˆ·å

 *  @param portrait     å¤´åƒURL

 */

- (instancetype)initWithUserId:(NSString *)userId name:(NSString *)username portrait:(NSString *)portrait;

è¿™ä¸ªç±»å°±ä¸€ä¸ªmodelç±»ï¼Œä¿å­˜äº†ä¸€ä¸ªäººçš„ç”¨æˆ·ä¿¡æ¯ï¼Œæœ‰ä¸‰ä¸ªï¼ŒuserIdï¼ˆå”¯ä¸€idï¼‰ï¼Œnameåå­—ï¼ŒportraitUriå¤´åƒåœ°å€url stringï¼Œç±»ä¸­æä¾›äº†ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œä¼ ä¸‰ä¸ªå‚æ•°å°±å¯ä»¥äº†ï¼Œå¤´åƒå¯ä»¥ç”¨nilï¼Œä¼ nilå°±ç”¨é»˜è®¤å¤´åƒã€‚å¤§å®¶çœ‹çœ‹æˆ‘çš„RCDataManagerç±»ä¸­ç”¨åˆ°çš„RCUserInfoçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯ä¸ä¸€æ ·ï¼Œ
        RCUserInfo *aUser = [[RCUserInfo alloc]initWithUserId:myselfInfo.userId name:myselfInfo.realNameportrait:myselfInfo.photo phone:myselfInfo.phone addressInfo:myselfInfo.companyrealName:myselfInfo.realName];

æˆ‘categoryäº†RCUserInfoæ·»åŠ äº†æˆ‘è¦çš„å±æ€§è¿›å»ï¼Œæ¯”å¦‚å…¬å¸åå­—ï¼Œåœ°å€ï¼ŒçœŸæ˜¯åå­—ç­‰ç­‰ã€‚åœ¨å¼€å‘ä¸­å¦‚æœè§‰å¾—RCUserInfoç±»ä¸­çš„å±æ€§ä¸å¤Ÿç”¨ï¼Œå¯èƒ½å¼€å‘è€…è¿˜éœ€è¦æ¯ä¸ªç”¨æˆ·å¸¦æœ‰æ›´å¤šçš„å±æ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨æˆ‘çš„æ–¹æ³•ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸ªç”¨æˆ·èº«ä¸Šå°±ç»‘å®šäº†å¾ˆå¤šçš„å±æ€§ï¼Œæƒ³æ€ä¹ˆç”¨å°±æ€ä¹ˆç”¨ã€‚
é‚£ä¹ˆç´§æ¥ç€æˆ‘æŠŠRCUserInfoçš„ç»™å¤§å®¶å±•ç¤ºä¸‹ï¼Œè¿™ä¸ªå¯èƒ½å¤§éƒ¨åˆ†å¼€å‘è€…éƒ½æœ‰è¿™ä¸ªéœ€æ±‚ã€‚æˆ‘æ˜¯ä¹‹ä¸€ï¼ŒåºŸè¯ä¸è¯´ï¼Œç›´æ¥ä¸Šä»£ç çœ‹.h

#import <RongIMLib/RongIMLib.h>



@interface RCUserInfo (Addition)

/**

 ç”¨æˆ·ä¿¡æ¯ç±»

 */

/** ç”¨æˆ·ID */

@property(nonatomic, strong) NSString *userId;

/** ç”¨æˆ·å*/

@property(nonatomic, strong) NSString *name;

/** å¤´åƒURL*/

@property(nonatomic, strong) NSString *portraitUri;

/** phone*/

@property(nonatomic, strong) NSString *phone;



/** addressInfo*/

@property(nonatomic, strong) NSString *addressInfo;





/** realName*/

@property(nonatomic, strong) NSString *realName;



/**

 

 æŒ‡æ´¾çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæ ¹æ®ç»™å®šå­—æ®µåˆå§‹åŒ–å®ä¾‹

 

 @param userId          ç”¨æˆ·ID

 @param username        ç”¨æˆ·å

 @param portrait        å¤´åƒURL

 @param phone           ç”µè¯

 @param addressInfo     addressInfo

 */

- (instancetype)initWithUserId:(NSString *)userId name:(NSString *)username portrait:(NSString *)portrait phone:(NSString *)phone addressInfo:(NSString *)addressInfo realName:(NSString *)realName;

@end


ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼åä¸½ä¸½çš„åˆ†å‰²çº¿ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼


å†çœ‹RCUerInfoçš„categoryçš„.mæ–‡ä»¶ã€‚è¿™é‡Œç”¨äº†runtimeçš„çŸ¥è¯†ï¼Œä¸æ‡‚çš„è¯·è‡ªè¡Œç™¾åº¦
#import "RCUserInfo+Addition.h"

#import <objc/runtime.h>









@implementation RCUserInfo (Addition)

@dynamic addressInfo;

@dynamic phone;

- (instancetype)initWithUserId:(NSString *)userId name:(NSString *)username portrait:(NSString *)portrait phone:(NSString *)phone addressInfo:(NSString *)addressInfo realName:(NSString *)realName{

    if (self = [super init]) {

        self.userId        =   userId;

        self.name          =   username;

        self.portraitUri   =   portrait;

        self.phone         =   phone;

        self.addressInfo   =   addressInfo;

        self.realName     =   realName;



    }

    return self;

}



//æ·»åŠ å±æ€§æ‰©å±•setæ–¹æ³•

char* const PHONE = "PHONE";

char* const ADDRESSINFO = "ADDRESSINFO";

char* const REALNAME   = "REALNAME";



-(void)setPhone:(NSString *)newPhone{

    

    objc_setAssociatedObject(self,PHONE,newPhone,OBJC_ASSOCIATION_RETAIN_NONATOMIC);

    

}

-(void)setAddressInfo:(NSString *)newAddressInfo{

    

    objc_setAssociatedObject(self,ADDRESSINFO,newAddressInfo,OBJC_ASSOCIATION_RETAIN_NONATOMIC);



}

-(void)setRealName:(NSString *)nweRealName{

    

    objc_setAssociatedObject(self,REALNAME,nweRealName,OBJC_ASSOCIATION_RETAIN_NONATOMIC);

    

}

//æ·»åŠ å±æ€§æ‰©å±•getæ–¹æ³•

-(NSString *)phone{

    return objc_getAssociatedObject(self,PHONE);

}

-(NSString *)addressInfo{

    return objc_getAssociatedObject(self,ADDRESSINFO);

}

-(NSString *)realName{

    return objc_getAssociatedObject(self,REALNAME);

}



@end






//è·å–ä¸€ä¸ªuserIdçš„å¥½å‹çš„åå­—

-(NSString *)currentNameWithUserId:(NSString *)userId{

    for (NSInteger i = 0; i<[AppDelegate shareAppDelegate].friendsArray.count; i++) {

        RCUserInfo *aUser = [AppDelegate shareAppDelegate].friendsArray[i];

        if ([userId isEqualToString:aUser.userId]) {

            NSLog(@"current ï¼ %@",aUser.name);

            return aUser.name;

        }

    }

    return nil;

}

//è¿™ä¸ªä»£ç†æ–¹æ³•å¾ˆé‡è¦ï¼Œå¥½å‹ä¿¡æ¯çš„æä¾›è€…ï¼Œå•ä¾‹çš„æ—¶å€™ï¼Œæ˜¯ä¸€å®šè¦å®ç°è¿™ä¸ªä»£ç†æ–¹æ³•çš„ï¼Œå¹¶æŠŠä½ çš„å¥½å‹ä¿¡æ¯ç”¨ä¸€ä¸ªforå¾ªç¯ç»™completionã€‚

#pragma mark - RCIMUserInfoDataSource

- (void)getUserInfoWithUserId:(NSString*)userId completion:(void (^)(RCUserInfo*))completion

{

    NSLog(@"getUserInfoWithUserId ----- %@", userId);

    

    if (userId == nil || [userId length] == 0 )

    {

        completion(nil);

        return ;

    }

   

    if ([userId isEqualToString:[RCIM sharedRCIM].currentUserInfo.userId]) {

        UserInfoModel *myselfInfo = [UserInfoModel currentUserinfo];

        RCUserInfo *aUser = [[RCUserInfo alloc]initWithUserId:myselfInfo.userId name:myselfInfo.realNameportrait:myselfInfo.photo phone:myselfInfo.phone addressInfo:myselfInfo.companyrealName:myselfInfo.realName];

        completion(aUser);

    }

    

    for (NSInteger i = 0; i<[AppDelegate shareAppDelegate].friendsArray.count; i++) {

        RCUserInfo *aUser = [AppDelegate shareAppDelegate].friendsArray[i];

        if ([userId isEqualToString:aUser.userId]) {

            completion(aUser);

        }

    }

}

//ç™»å½•èäº‘

-(void)loginRongCloud{

    UserInfoModel *userinfo = [UserInfoModel currentUserinfo];

    if (userinfo.login==YES&&![userinfo.userId isEqualToString:@""]&&![RCIMClientsharedRCIMClient].currentUserInfo.userId) {

        [Networking getAppUserTokenWithUserId:userinfo.userId name:userinfo.realNameportraitUri:userinfo.photo success:^(NetworkModel *model) {

            if ([model.result isEqualToString:@"10000"]) {

                NSLog(@"RCToken = %@",model.data);//model.dataå°±æ˜¯æˆ‘ä»¬çš„tokenå•¦ï¼Œæœ‰äº†ä»–ï¼Œæˆ‘ä»¬æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥connect

                self.success = YES;

                [[RCIM sharedRCIM] connectWithToken:model.data success:^(NSString *userId) {

                    [RCIM sharedRCIM].globalNavigationBarTintColor = [UIColor whiteColor];

                    NSLog(@"login success with userId %@",userId);

                    [UserInfoModel loginUserinfo:model];

                    //åŒæ­¥å¥½å‹åˆ—è¡¨

                    [self syncFriendList:^(NSMutableArray *friends, BOOL isSuccess) {

                        NSLog(@"%@",friends);

                        if (isSuccess) {

                            NSLog(@" success å‘é€é€šçŸ¥");

                            [[NSNotificationCenter defaultCenter] postNotificationName:@"alreadyLogin"object:nil];

                        }

                    }];

//ç™»å½•æˆåŠŸï¼Œè®¾ç½®å½“å‰ç”¨æˆ·æ˜¯XXX

                    [RCIMClient sharedRCIMClient].currentUserInfo = [[RCUserInfo alloc] initWithUserId:userinfo.userId name:userinfo.userName portrait:userinfo.photo phone:userinfo.phoneaddressInfo:userinfo.company realName:userinfo.realName];

                   

                    

                    [[RCDataManager shareManager] refreshBadgeValue];

                } error:^(RCConnectErrorCode status) {

                    NSLog(@"status = %ld",(long)status);

                } tokenIncorrect:^{

                    self.success = NO;

                    [MSUtil showTipsWithHUD:@"tokenIncorrect"];

                }];

            }

            

        } fail:^(NSError *error) {

            NSLog(@"error %@",error);

            self.success = NO;

        }];

    }else{



    }

}

//åˆ·æ–°è§’æ ‡

-(void)refreshBadgeValue{

    

    dispatch_async(dispatch_get_main_queue(), ^{

        

        int notReadMessage = [[UserInfoModel currentUserinfo].notReadMessage intValue];

        

        NSInteger unreadMsgCount = (NSInteger)[[RCIMClient sharedRCIMClient] getUnreadCount:@[@(ConversationType_PRIVATE)]];

        BaseNavigationController  *chatNav = [AppDelegate shareAppDelegate].rootTabbar.viewControllers[2];

        if (unreadMsgCount == 0) {

            chatNav.tabBarItem.badgeValue = nil;

            if (notReadMessage > 0) {

                [UIApplication sharedApplication].applicationIconBadgeNumber = notReadMessage;

            }

            else {

                [UIApplication sharedApplication].applicationIconBadgeNumber = 0;

            }



        }else{

            chatNav.tabBarItem.badgeValue = [NSString stringWithFormat:@"%li",(long)unreadMsgCount];

            if (notReadMessage > 0) {

                [UIApplication sharedApplication].applicationIconBadgeNumber = unreadMsgCount + notReadMessage;

            }

            else {

                [UIApplication sharedApplication].applicationIconBadgeNumber = unreadMsgCount;

            }



        }

    });

}

//åˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ªå¥½å‹

-(BOOL)hasTheFriendWithUserId:(NSString *)userId{

    if ([AppDelegate shareAppDelegate].friendsArray.count) {

        NSMutableArray *tempArray = [[NSMutableArray alloc]init];



        for (RCUserInfo *aUserInfo in [AppDelegate shareAppDelegate].friendsArray) {

            [tempArray addObject:aUserInfo.userId];

        }

        

        if ([tempArray containsObject:userId]) {

            return YES;

        }

    }

    

    

    return NO;

}

@end


å¥½ï¼Œåˆ°æ­¤å¤„ï¼Œå·²ç»æŠŠèäº‘çš„é€»è¾‘åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶ä¸”ç™»å½•äº†èäº‘æœåŠ¡å™¨ã€‚ä¸‹ä¸€ç¯‡ç« è¯¥è®²å¦‚ä½•èŠå¤©ï¼Œç”ŸæˆèŠå¤©åˆ—è¡¨ï¼Œæ˜¾ç¤ºå¤´åƒåå­—ç­‰ã€‚
æŒç»­å…³æ³¨ï¼ŒæŒç»­æ›´æ–°ï¼Œè°¢è°¢ã€‚åšä¸»åŸåˆ›ï¼Œä¸å¾—è½¬è½½ï¼Œè°¢è°¢ã€‚

